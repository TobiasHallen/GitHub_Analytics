<!DOCTYPE html>
<head>
  <meta charset="utf-8">
</head>
<style>

.node {
  stroke: #777;
  stroke-width: 1.0px;
}

.link {
  stroke: #777;
  stroke-opacity: .2;
}

.login {
  pointer-events: none;
}

.repos {
  pointer-events: none;
}



</style>
<body>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>
var width = window.innerWidth - 30;
height = window.innerHeight - 30;

  var simulation = d3.forceSimulation()
		.force("charge", d3.forceManyBody().strength(function(d) {return -30 * Math.sqrt(d.repos) * .8}))
		.force("link", d3.forceLink().strength(1.0).distance(50))
		.force("forceX", d3.forceX().strength(.1).x(width * .5))
        .force("forceY", d3.forceY().strength(.1).y(height * .5))
        .force("center", d3.forceCenter().x(width * .5).y(height * .5))
		
var svg = d3.select("body").append("svg")
  .attr("height", height)
  .attr("width", width)
  .on("contextmenu", function(d, i) {
    d3.event.preventDefault(); 
  });

var graphGroup = svg.append("g");
var useGroup = svg.append("g");


	
var data = "data/50graph.json";

drawGraph();


function drawGraph() {
	
  d3.json(data, function(error, drawGraph) {	
  
  svg.select("#useGroupBox").remove();

    graphGroup
      .attr("class", "drawGraph")
      .attr("id", "drawGraph");

	  
    var link = graphGroup.selectAll(".link")
      .data(drawGraph.index)
      .enter().append("line")
      .attr("class", "link")
	  .style("stroke-opacity", function(d) {return .4})
      .style("stroke-width", function(d) {return 5});

	  	
    var colour = function(d) {
      var r = Math.floor(250 - (75 * (d.repos / 8242)));
      var g = Math.floor(100 - (75 * (d.repos / 8242)));
      var b = Math.floor(100 - (75 * (d.repos / 8242)));
      return d3.rgb(r, g, b);
    };
	
    var node = graphGroup.selectAll(".node")
      .data(drawGraph.users)
      .enter().append("circle")
      .attr("class", "node")
      .attr("r", function(d) {return 1.0 * Math.sqrt(d.repos);})
      .style("fill", function(d) {return colour(d).toString();})
	  .style("stroke", "White")
	  .style("stroke-width", "2")
      .call(d3.drag()
		.on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended));

	var loginLabel = graphGroup.selectAll(".login")
      .data(drawGraph.users)
      .enter().append("text")
      .attr("class", "login")
	  .attr("font-family", "sans-serif")
      .attr("dx", function(d) {return 0;})
      .attr("dy", ".4em")
      .attr("font-size", 11)
      .style("fill", "#0")
	  .style("text-anchor", "middle")
      .text(function(d) {return d.login;});

    var repoLabel = graphGroup.selectAll(".repos")
      .data(drawGraph.users)
      .enter().append("text")
      .attr("class", "repos")
	  .attr("font-family", "sans-serif")
      .attr("dx", function(d) {0;})
      .attr("dy", "1.5em")
      .attr("font-size", 11)
	  .style("text-anchor", "middle")
      .style("fill", "#0")
      .text(function(d) {return d.repos;});  
	  
    simulation
      .nodes(drawGraph.users)
      .on("tick", ticked);
	  
	simulation.force("link")
      .links(drawGraph.index);
		
    function ticked() {
		
      node.attr("cx", function(d) {
          var radius = d3.select(this).attr("r");
          return d.x = Math.max(radius, Math.min(width - radius, d.x));
        })
        .attr("cy", function(d) {
          var radius = d3.select(this).attr("r");
          return d.y = Math.max(radius, Math.min(height - radius, d.y));
        });

      link
        .attr("x1", function(d) { return d.source.x; })
        .attr("y1", function(d) { return d.source.y; })
        .attr("x2", function(d) { return d.target.x; })
        .attr("y2", function(d) { return d.target.y; });

      loginLabel.attr("x", function(d) {return d.x;})
        .attr("y", function(d) {return d.y;});

      repoLabel.attr("x", function(d) {return d.x;})
        .attr("y", function(d) {return d.y;});
    };

	function dragstarted(d) {
	  if (!d3.event.active) simulation.alphaTarget(0.3).restart();
	  d.fx = d.x;
	  d.fy = d.y;
	};

	function dragged(d) {
	  d.fx = d3.event.x;
	  d.fy = d3.event.y;
	};

	function dragended(d) {
	  if (!d3.event.active) simulation.alphaTarget(0);
	  d.fx = null;
	  d.fy = null;
};

  });
}
</script>
